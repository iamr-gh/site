---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import SearchBar from '../../components/blog/SearchBar.astro';
import PostPreview from '../../components/blog/PostPreview.astro';
import { categories } from '../../lib/categories.js';

const allPosts = await getCollection('blog');
---

<Layout title="Blog | iamr">
  <Header />
  <main class="container py-8">
    
    <!-- Search Section -->
    <SearchBar />
    
    <!-- Category-based Tag Filters -->
    <div class="max-w-4xl mx-auto mb-8">
      <div class="flex gap-4 mb-6 flex-wrap items-center">
        <span class="text-lg font-medium">Filter by category:</span>
        <a 
          href="/blog" 
          class={`inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
            true ? 'bg-primary text-primary-foreground' : 'bg-secondary text-secondary-foreground hover:bg-accent hover:text-accent-foreground'
          }`}
        >
          All
        </a>
        {categories.map(category => (
          <>
            <div class="w-px h-4 bg-muted"></div>
            <span class="text-sm font-medium px-2">{category.name}</span>
            <div class="flex gap-2 flex-wrap">
              {category.tags.map((tag: string) => (
                <span class="inline-flex items-center px-3 py-1 bg-secondary text-secondary-foreground rounded-full text-xs font-medium hover:bg-primary hover:text-primary-foreground transition-colors cursor-pointer">
                  {tag}
                </span>
              ))}
            </div>
          </>
        ))}
      </div>
    </div>
    
    <!-- Blog Posts Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto" id="posts-grid">
      {allPosts.map((post: any) => (
        <div class="post-card" data-title={post.data.title} data-description={post.data.description} data-tags={post.data.tags?.join(' ') || ''}>
          <PostPreview post={post} />
        </div>
      ))}
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="hidden text-center py-12">
      <p class="text-muted-foreground text-lg">No blog posts found matching your search.</p>
    </div>
  </main>
</Layout>

<script define:vars={{ allPosts }}>
  window.blogPosts = allPosts.map(post => ({
    slug: post.slug,
    title: post.data.title,
    description: post.data.description,
    tags: post.data.tags || [],
    pubDate: post.data.pubDate,
    author: post.data.author
  }));
</script>