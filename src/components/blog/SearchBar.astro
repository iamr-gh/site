---
import { Search } from 'lucide-react';
---

<div class="relative mb-6 sm:mb-8">
  <input
    type="text"
    placeholder="Search posts..."
    class="w-full pl-10 pr-4 py-3 sm:py-3 border border-input bg-background rounded-lg text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 placeholder:text-muted-foreground"
    id="search-input"
  />
  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground" />
</div>

<script>
  // Wait for DOM and data to be ready
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const postsList = document.getElementById('posts-list');
    const noResults = document.getElementById('no-results');
    
    if (!searchInput || !postsList || !noResults) {
      console.error('Search components not found');
      return;
    }

    // Wait for blog posts data to be available
    const waitForData = function() {
      if (typeof window.blogPosts === 'undefined') {
        setTimeout(waitForData, 100);
        return;
      }

      console.log('Blog posts loaded:', window.blogPosts.length);
      initializeSearch();
    };

    const initializeSearch = function() {
      let searchTimeout;

      const performSearch = function(query) {
        const postItems = postsList.querySelectorAll('.post-item');
        
        if (!query || query.trim() === '') {
          postItems.forEach(item => {
            item.style.display = 'block';
          });
          noResults.classList.add('hidden');
          return;
        }

        const lowerQuery = query.toLowerCase();
        let visibleCount = 0;

        postItems.forEach(item => {
          const title = (item.dataset.title || '').toLowerCase();
          const description = (item.dataset.description || '').toLowerCase();
          const tags = (item.dataset.tags || '').toLowerCase();
          
          const matchesSearch = title.includes(lowerQuery) || 
                                description.includes(lowerQuery) || 
                                tags.includes(lowerQuery);

          if (matchesSearch) {
            item.style.display = 'block';
            visibleCount++;
          } else {
            item.style.display = 'none';
          }
        });

        // Show/hide no results message
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
        }
      };

      searchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performSearch(e.target.value);
        }, 300);
      });
    };

    waitForData();
  });
</script>